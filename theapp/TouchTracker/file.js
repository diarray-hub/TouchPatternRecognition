//import * as tf from '@tensorflow/tfjs';

touchTracks = [
    {
      "id": "4537045",
      "positions": [
        [
          311,
          340
        ],
        [
          311,
          344
        ],
        [
          311,
          349
        ],
        [
          311,
          353
        ],
        [
          311,
          362
        ],
        [
          312,
          373
        ],
        [
          313,
          386
        ],
        [
          314,
          404
        ],
        [
          315,
          415
        ],
        [
          315,
          429
        ],
        [
          314,
          444
        ],
        [
          309,
          460
        ],
        [
          305,
          475
        ],
        [
          302,
          491
        ],
        [
          300,
          506
        ],
        [
          298,
          520
        ],
        [
          298,
          535
        ],
        [
          298,
          554
        ],
        [
          298,
          572
        ],
        [
          298,
          588
        ],
        [
          299,
          607
        ],
        [
          301,
          617
        ],
        [
          305,
          625
        ],
        [
          308,
          634
        ],
        [
          312,
          642
        ],
        [
          316,
          652
        ],
        [
          318,
          660
        ],
        [
          321,
          666
        ],
        [
          323,
          672
        ],
        [
          325,
          677
        ],
        [
          326,
          682
        ],
        [
          327,
          687
        ],
        [
          328,
          691
        ],
        [
          329,
          695
        ],
        [
          329,
          700
        ],
        [
          329,
          704
        ],
        [
          328,
          709
        ],
        [
          322,
          715
        ],
        [
          314,
          721
        ],
        [
          303,
          724
        ],
        [
          290,
          725
        ],
        [
          277,
          726
        ],
        [
          268,
          727
        ],
        [
          258,
          728
        ],
        [
          246,
          728
        ],
        [
          236,
          728
        ],
        [
          221,
          728
        ],
        [
          214,
          728
        ],
        [
          208,
          727
        ],
        [
          204,
          726
        ],
        [
          200,
          724
        ],
        [
          197,
          724
        ],
        [
          194,
          722
        ],
        [
          192,
          721
        ],
        [
          189,
          719
        ],
        [
          188,
          718
        ],
        [
          186,
          717
        ],
        [
          184,
          715
        ],
        [
          183,
          712
        ],
        [
          182,
          700
        ],
        [
          182,
          687
        ],
        [
          183,
          671
        ],
        [
          186,
          653
        ],
        [
          188,
          633
        ],
        [
          188,
          615
        ],
        [
          188,
          597
        ],
        [
          188,
          580
        ],
        [
          188,
          565
        ],
        [
          188,
          549
        ],
        [
          188,
          531
        ],
        [
          188,
          514
        ],
        [
          188,
          499
        ],
        [
          188,
          481
        ],
        [
          189,
          471
        ],
        [
          190,
          460
        ],
        [
          190,
          450
        ],
        [
          191,
          442
        ],
        [
          193,
          434
        ],
        [
          194,
          426
        ],
        [
          195,
          418
        ],
        [
          196,
          409
        ],
        [
          196,
          400
        ],
        [
          196,
          392
        ],
        [
          196,
          386
        ],
        [
          196,
          381
        ],
        [
          196,
          377
        ],
        [
          196,
          374
        ],
        [
          196,
          371
        ],
        [
          196,
          368
        ],
        [
          196,
          365
        ],
        [
          194,
          362
        ],
        [
          192,
          358
        ],
        [
          190,
          355
        ],
        [
          187,
          353
        ],
        [
          185,
          351
        ],
        [
          182,
          350
        ],
        [
          178,
          349
        ],
        [
          171,
          348
        ],
        [
          157,
          348
        ],
        [
          147,
          348
        ],
        [
          134,
          350
        ],
        [
          121,
          354
        ],
        [
          111,
          360
        ],
        [
          104,
          364
        ],
        [
          97,
          367
        ],
        [
          90,
          370
        ],
        [
          82,
          372
        ],
        [
          76,
          374
        ],
        [
          69,
          376
        ],
        [
          64,
          377
        ],
        [
          58,
          378
        ],
        [
          55,
          378
        ],
        [
          53,
          379
        ],
        [
          52,
          381
        ],
        [
          51,
          382
        ],
        [
          51,
          384
        ],
        [
          51,
          389
        ],
        [
          51,
          397
        ],
        [
          51,
          407
        ],
        [
          51,
          420
        ],
        [
          51,
          433
        ],
        [
          51,
          448
        ],
        [
          51,
          465
        ],
        [
          51,
          488
        ],
        [
          51,
          505
        ],
        [
          51,
          522
        ],
        [
          51,
          540
        ],
        [
          51,
          558
        ],
        [
          51,
          575
        ],
        [
          52,
          590
        ],
        [
          55,
          602
        ],
        [
          57,
          611
        ],
        [
          60,
          622
        ],
        [
          62,
          634
        ],
        [
          63,
          645
        ],
        [
          65,
          653
        ],
        [
          67,
          663
        ],
        [
          68,
          668
        ],
        [
          68,
          672
        ],
        [
          68,
          677
        ],
        [
          68,
          683
        ],
        [
          68,
          689
        ],
        [
          68,
          693
        ],
        [
          68,
          698
        ],
        [
          69,
          702
        ],
        [
          70,
          706
        ],
        [
          70,
          710
        ],
        [
          70,
          714
        ],
        [
          71,
          717
        ],
        [
          71,
          720
        ]
      ],
      "speeds": [
        68.96541291569038,
        357.1444141689373,
        333.3310021457522,
        750.0096560767718,
        649.7286495074906,
        814.8986492110176,
        783.8154296656808,
        690.3336645730468,
        874.9982267654115,
        1073.8115656164,
        986.0643594340515,
        970.2589522302851,
        957.5799383126009,
        1008.8426745742182,
        883.8816852457528,
        882.3550201253804,
        1117.6496921588152,
        1124.9977201269576,
        941.1786881337391,
        827.2302614184321,
        728.43453480723,
        526.1275026533871,
        592.9258596829728,
        526.1348814102788,
        673.1442367260271,
        485.0723929694587,
        419.26189612269343,
        395.28979672035746,
        336.57211836301354,
        299.9430310357246,
        318.6880737597084,
        242.5327950458692,
        242.53619648472935,
        238.09627611262488,
        249.99949336154614,
        318.6880737597084,
        530.3290111474516,
        624.9987334038653,
        712.6188153714929,
        766.9560396317484,
        814.9107923034837,
        565.9604241820072,
        628.1159534066941,
        705.8840161003043,
        588.236680083587,
        681.815876456245,
        437.49911338270573,
        380.17188770328784,
        257.693579370139,
        279.5079307484623,
        187.50241401919294,
        225.34649803876843,
        139.75396537423114,
        225.34649803876843,
        88.38816852457528,
        131.5337203525697,
        166.37845817190643,
        197.6419532276576,
        547.3433574446691,
        764.707684108663,
        1068.7404951027786,
        1073.4312109678392,
        1256.2319068133882,
        1125.0144841151578,
        1124.9977201269576,
        1062.497846786571,
        937.498100105798,
        999.9979734461846,
        1058.8260241504565,
        1000.0023561420978,
        937.498100105798,
        818.1790517474939,
        628.1159534066941,
        690.3336645730468,
        625.0080467306432,
        503.89008810620925,
        515.387158740278,
        503.89008810620925,
        474.25157318373135,
        565.9604241820072,
        562.4988600634788,
        470.58934406686956,
        352.94200805015214,
        312.4993667019327,
        181.81756705499865,
        187.49962002115961,
        187.50241401919294,
        187.49962002115961,
        187.49962002115961,
        225.34649803876843,
        279.5079307484623,
        225.34649803876843,
        225.34649803876843,
        166.37845817190643,
        186.01677123199408,
        257.693579370139,
        415.9461454297661,
        636.3614846924953,
        666.6726006930095,
        822.0574864257574,
        850.090184038968,
        685.9959568701801,
        503.89008810620925,
        475.98485450561645,
        475.98485450561645,
        515.387158740278,
        372.03354246398817,
        455.00594598412783,
        299.9430310357246,
        276.4882710580324,
        187.50241401919294,
        139.75396537423114,
        139.75396537423114,
        88.38816852457528,
        124.99974668077307,
        312.4993667019327,
        499.9989867230923,
        588.236680083587,
        812.498353425025,
        812.510460749836,
        882.3426455738809,
        1000.0023561420978,
        1045.4510105662423,
        1062.5136794420932,
        1062.497846786571,
        1124.9977201269576,
        1124.9977201269576,
        1062.497846786571,
        939.5791195367983,
        773.0807381104169,
        576.2289472998955,
        712.6081965451749,
        715.6208073118927,
        649.719537414908,
        485.0723929694587,
        485.62302320481996,
        318.6880737597084,
        249.99949336154614,
        312.4993667019327,
        352.94200805015214,
        374.99924004231923,
        249.99949336154614,
        312.4993667019327,
        257.69741935314204,
        257.693579370139,
        235.29467203343478,
        235.2913721530349,
        197.64489836017873,
        130.4347717919746
      ],
      "directions": [
        1.5707963267948966,
        1.5707963267948966,
        1.5707963267948966,
        1.5707963267948966,
        1.4801364395941514,
        1.4940244355251187,
        1.5152978215491797,
        1.4801364395941514,
        1.5707963267948966,
        1.6373644905707205,
        1.873681195169868,
        1.8313987185422376,
        1.7561442767905915,
        1.7033478590915707,
        1.7126933813990606,
        1.5707963267948966,
        1.5707963267948966,
        1.5707963267948966,
        1.5707963267948966,
        1.5182132651839548,
        1.373400766945016,
        1.1071487177940904,
        1.2490457723982544,
        1.1071487177940904,
        1.1902899496825317,
        1.3258176636680326,
        1.1071487177940904,
        1.2490457723982544,
        1.1902899496825317,
        1.373400766945016,
        1.373400766945016,
        1.3258176636680326,
        1.3258176636680326,
        1.5707963267948966,
        1.5707963267948966,
        1.7681918866447774,
        2.356194490192345,
        2.498091544796509,
        2.875340604438868,
        3.064820762320015,
        3.064820762320015,
        3.0309354324158977,
        3.0419240010986313,
        3.141592653589793,
        3.141592653589793,
        3.141592653589793,
        3.141592653589793,
        -2.976443976175166,
        -2.896613990462929,
        -2.677945044588987,
        3.141592653589793,
        -2.5535900500422257,
        -2.677945044588987,
        -2.5535900500422257,
        -2.356194490192345,
        -2.677945044588987,
        -2.356194490192345,
        -1.892546881191539,
        -1.6539375586833378,
        -1.5707963267948966,
        -1.5083775167989393,
        -1.4056476493802699,
        -1.4711276743037347,
        -1.5707963267948966,
        -1.5707963267948966,
        -1.5707963267948966,
        -1.5707963267948966,
        -1.5707963267948966,
        -1.5707963267948966,
        -1.5707963267948966,
        -1.5707963267948966,
        -1.5707963267948966,
        -1.4711276743037347,
        -1.4801364395941514,
        -1.5707963267948966,
        -1.446441332248135,
        -1.3258176636680326,
        -1.446441332248135,
        -1.446441332248135,
        -1.460139105621001,
        -1.5707963267948966,
        -1.5707963267948966,
        -1.5707963267948966,
        -1.5707963267948966,
        -1.5707963267948966,
        -1.5707963267948966,
        -1.5707963267948966,
        -1.5707963267948966,
        -1.5707963267948966,
        -2.158798930342464,
        -2.0344439357957027,
        -2.158798930342464,
        -2.5535900500422257,
        -2.356194490192345,
        -2.819842099193151,
        -2.896613990462929,
        -2.999695598985629,
        3.141592653589793,
        3.141592653589793,
        2.988943325194528,
        2.843093722003614,
        2.601173153319209,
        2.62244653934327,
        2.7367008673047097,
        2.7367008673047097,
        2.896613990462929,
        2.819842099193151,
        2.8632929945846817,
        2.9441970937399127,
        2.976443976175166,
        3.141592653589793,
        2.677945044588987,
        2.0344439357957027,
        2.356194490192345,
        1.5707963267948966,
        1.5707963267948966,
        1.5707963267948966,
        1.5707963267948966,
        1.5707963267948966,
        1.5707963267948966,
        1.5707963267948966,
        1.5707963267948966,
        1.5707963267948966,
        1.5707963267948966,
        1.5707963267948966,
        1.5707963267948966,
        1.5707963267948966,
        1.5707963267948966,
        1.5042281630190728,
        1.3258176636680326,
        1.3521273809209546,
        1.3045442776439713,
        1.4056476493802699,
        1.4801364395941514,
        1.3258176636680326,
        1.373400766945016,
        1.373400766945016,
        1.5707963267948966,
        1.5707963267948966,
        1.5707963267948966,
        1.5707963267948966,
        1.5707963267948966,
        1.5707963267948966,
        1.3258176636680326,
        1.3258176636680326,
        1.5707963267948966,
        1.5707963267948966,
        1.2490457723982544,
        1.5707963267948966
      ],
      "startTimestamp": 1683563422.089,
      "endTimestamp": 1683563424.611
    }
]

// Recognition
async function recognizeUser(touchTracks){
    document.write("yo!\n")
    const data = preprocess(touchTracks);
    document.write(data);
    const model = await tf.loadLayersModel('../../Models/tfjs_model/model.json');
    document.write("\nyo!")
    //const outcome = model.predict(data);
    if (model) {
        // Redirect the user to another page
        document.write("Yo!")
        //window.location.href = "https://diarray-hub.github.io/TouchPatternRecognition/theapp/Welcome.html";
    } 
    else {
        document.write("Oh No!")
        //window.location.href = "https://diarray-hub.github.io/TouchPatternRecognition/theapp/Error.html";
    }
}

function preprocess(touchTrackingArray){
    var touch = touchTrackingArray[0],
        positionX = [],
        positionY = [],
        speeds = touch.speeds,
        directions = touch.directions,
        latency = touch.endTimestamp - touch.startTimestamp
    touch.positions.forEach(position => {
        positionX.push(position[0])
        positionY.push(position[1])
    });
    fields = [positionX, positionY, speeds, directions];
    // Calculate the features
    const features = fields.map(field => {
        const mean = field.reduce((a, b) => a + b) / field.length;
        const stdDev = Math.sqrt(field.map(x => Math.pow(x - mean, 2)).reduce((a, b) => a + b) / field.length);
        const min = Math.min(...field);
        const max = Math.max(...field);
        const range = max - min;
        return [mean, stdDev, min, max, range];
    });
    
    // Flatten the features into a single list
    const flattenedFeatures = features.reduce((acc, val) => acc.concat(val), []);
    flattenedFeatures.push(latency);
    return [flattenedFeatures]
}

recognizeUser(touchTracks);